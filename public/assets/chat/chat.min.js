window.zammadChatTemplates||(window.zammadChatTemplates={}),window.zammadChatTemplates.agent=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?n(t):""}var s=[],i=(t=t||{}).safe,n=t.escape,n=(t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");t=new String(t);return t.ecoSafe=!0,t},n||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}));return function(){(function(){this.agent.avatar&&(s.push('\n<img class="zammad-chat-agent-avatar" src="'),s.push(e(this.agent.avatar)),s.push('">\n')),s.push('\n<span class="zammad-chat-agent-sentence">\n  <span class="zammad-chat-agent-name">'),s.push(e(this.agent.name)),s.push("</span>\n</span>")}).call(this)}.call(t),t.safe=i,t.escape=n,s.join("")};var bind=function(t,e){return function(){return t.apply(e,arguments)}},slice=[].slice,extend=function(t,e){for(var s in e)hasProp.call(e,s)&&(t[s]=e[s]);function i(){this.constructor=t}return i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype,t},hasProp={}.hasOwnProperty;!function(p,m){var e,s,i,n,o,t;function a(t){this.options=p.extend({},this.defaults,t),this.log=new s({debug:this.options.debug,logPrefix:this.options.logPrefix||this.logPrefix})}function r(t){this.log=bind(this.log,this),this.error=bind(this.error,this),this.notice=bind(this.notice,this),this.debug=bind(this.debug,this),this.options=p.extend({},this.defaults,t)}function l(t){this.stop=bind(this.stop,this),this.start=bind(this.start,this),l.__super__.constructor.call(this,t)}function h(t){this.ping=bind(this.ping,this),this.send=bind(this.send,this),this.reconnect=bind(this.reconnect,this),this.close=bind(this.close,this),this.connect=bind(this.connect,this),this.set=bind(this.set,this),h.__super__.constructor.call(this,t)}function c(t){return this.removeAttributes=bind(this.removeAttributes,this),this.startTimeoutObservers=bind(this.startTimeoutObservers,this),this.onCssLoaded=bind(this.onCssLoaded,this),this.setAgentOnlineState=bind(this.setAgentOnlineState,this),this.onConnectionEstablished=bind(this.onConnectionEstablished,this),this.setSessionId=bind(this.setSessionId,this),this.onConnectionReestablished=bind(this.onConnectionReestablished,this),this.reconnect=bind(this.reconnect,this),this.destroy=bind(this.destroy,this),this.onScrollHintClick=bind(this.onScrollHintClick,this),this.detectScrolledtoBottom=bind(this.detectScrolledtoBottom,this),this.onLeaveTemporary=bind(this.onLeaveTemporary,this),this.onAgentTypingEnd=bind(this.onAgentTypingEnd,this),this.onAgentTypingStart=bind(this.onAgentTypingStart,this),this.onQueue=bind(this.onQueue,this),this.onQueueScreen=bind(this.onQueueScreen,this),this.onWebSocketClose=bind(this.onWebSocketClose,this),this.onCloseAnimationEnd=bind(this.onCloseAnimationEnd,this),this.close=bind(this.close,this),this.toggle=bind(this.toggle,this),this.sessionClose=bind(this.sessionClose,this),this.onOpenAnimationEnd=bind(this.onOpenAnimationEnd,this),this.open=bind(this.open,this),this.onClickIntentButton=bind(this.onClickIntentButton,this),this.renderIntentButton=bind(this.renderIntentButton,this),this.renderMessage=bind(this.renderMessage,this),this.receiveMessage=bind(this.receiveMessage,this),this.onSubmit=bind(this.onSubmit,this),this.onFocus=bind(this.onFocus,this),this.onInput=bind(this.onInput,this),this.onReopenSession=bind(this.onReopenSession,this),this.onError=bind(this.onError,this),this.onWebSocketMessage=bind(this.onWebSocketMessage,this),this.send=bind(this.send,this),this.checkForEnter=bind(this.checkForEnter,this),this.render=bind(this.render,this),this.view=bind(this.view,this),this.T=bind(this.T,this),this.options=p.extend({},this.defaults,t),c.__super__.constructor.call(this,this.options),this.isFullscreen=m.matchMedia&&m.matchMedia("(max-width: 768px)").matches,this.scrollRoot=p(this.getScrollRoot()),p?m.WebSocket&&sessionStorage?this.options.chatId?(this.options.lang||(this.options.lang=p("html").attr("lang")),this.options.lang&&(this.translations[this.options.lang]||(this.log.debug("lang: No "+this.options.lang+" found, try first two letters"),this.options.lang=this.options.lang.replace(/-.+?$/,"")),this.log.debug("lang: "+this.options.lang)),this.options.host||this.detectHost(),this.loadCss(),this.io=new e(this.options),this.io.set({onOpen:this.render,onClose:this.onWebSocketClose,onMessage:this.onWebSocketMessage,onError:this.onError}),void this.io.connect()):(this.state="unsupported",void this.log.error("Chat: need chatId as option!")):(this.state="unsupported",void this.log.notice("Chat: Browser not supported!")):(this.state="unsupported",void this.log.notice("Chat: no jquery found!"))}t=(t=document.getElementsByTagName("script"))[t.length-1],o=m.location.protocol.replace(":",""),t&&t.src&&(n=t.src.match(".*://([^:/]*).*")[1],o=t.src.match("(.*)://[^:/]*.*")[1]),a.prototype.defaults={debug:!1},t=a,r.prototype.defaults={debug:!1},r.prototype.debug=function(){var t=1<=arguments.length?slice.call(arguments,0):[];if(this.options.debug)return this.log("debug",t)},r.prototype.notice=function(){var t=1<=arguments.length?slice.call(arguments,0):[];return this.log("notice",t)},r.prototype.error=function(){var t=1<=arguments.length?slice.call(arguments,0):[];return this.log("error",t)},r.prototype.log=function(t,e){var s,i,n,o;if(e.unshift("||"),e.unshift(t),e.unshift(this.options.logPrefix),console.log.apply(console,e),this.options.debug){for(o="",i=0,n=e.length;i<n;i++)o+=" ","object"==typeof(s=e[i])?o+=JSON.stringify(s):s&&s.toString?o+=s.toString():o+=s;return p(".js-chatLogDisplay").prepend("<div>"+o+"</div>")}},s=r,extend(l,t),l.prototype.timeoutStartedAt=null,l.prototype.logPrefix="timeout",l.prototype.defaults={debug:!1,timeout:4,timeoutIntervallCheck:.5},l.prototype.start=function(){var t,e,s;return this.stop(),e=new Date,t=function(){var t=new Date-new Date(e.getTime()+1e3*s.options.timeout*60);if(s.log.debug("Timeout check for "+s.options.timeout+" minutes (left "+t/1e3+" sec.)"),!(t<0))return s.stop(),s.options.callback()},(s=this).log.debug("Start timeout in "+this.options.timeout+" minutes"),this.intervallId=setInterval(t,1e3*this.options.timeoutIntervallCheck*60)},l.prototype.stop=function(){if(this.intervallId)return this.log.debug("Stop timeout of "+this.options.timeout+" minutes"),clearInterval(this.intervallId)},i=l,extend(h,t),h.prototype.logPrefix="io",h.prototype.set=function(t){var e,s,i=[];for(e in t)s=t[e],i.push(this.options[e]=s);return i},h.prototype.connect=function(){var e,n,s,i;return this.log.debug("Connecting to "+this.options.host),this.ws=new m.WebSocket(""+this.options.host),this.ws.onopen=(e=this,function(t){return e.log.debug("onOpen",t),e.options.onOpen(t),e.ping()}),this.ws.onmessage=(n=this,function(t){var e,s,i=JSON.parse(t.data);for(n.log.debug("onMessage",t.data),e=0,s=i.length;e<s;e++)"pong"===i[e].event&&n.ping();if(n.options.onMessage)return n.options.onMessage(i)}),this.ws.onclose=(s=this,function(t){if(s.log.debug("close websocket connection",t),s.pingDelayId&&clearTimeout(s.pingDelayId),s.manualClose){if(s.log.debug("manual close, onClose callback"),s.manualClose=!1,s.options.onClose)return s.options.onClose(t)}else if(s.log.debug("error close, onError callback"),s.options.onError)return s.options.onError("Connection lost...")}),this.ws.onerror=(i=this,function(t){if(i.log.debug("onError",t),i.options.onError)return i.options.onError(t)})},h.prototype.close=function(){return this.log.debug("close websocket manually"),this.manualClose=!0,this.ws.close()},h.prototype.reconnect=function(){return this.log.debug("reconnect"),this.close(),this.connect()},h.prototype.send=function(t,e){return null==e&&(e={}),e=JSON.stringify({event:t,data:e}),this.ws.send(e)},h.prototype.ping=function(){var t,e=function(){return t.send("ping")};return(t=this).pingDelayId=setTimeout(e,29e3)},e=h,extend(c,t),c.prototype.defaults={chatId:void 0,show:!0,target:p("body"),host:"",debug:!1,flat:!1,lang:void 0,cssAutoload:!0,cssUrl:void 0,fontSize:void 0,buttonClass:"open-zammad-chat",inactiveClass:"is-inactive",title:"<strong>Chat</strong> with us!",scrollHint:"Scroll down to see new messages",idleTimeout:6,idleTimeoutIntervallCheck:.5,inactiveTimeout:8,inactiveTimeoutIntervallCheck:.5,waitingListTimeout:4,waitingListTimeoutIntervallCheck:.5,onReady:void 0,onCloseAnimationEnd:void 0,onError:void 0,onOpenAnimationEnd:void 0,onConnectionReestablished:void 0,onSessionClosed:void 0,onConnectionEstablished:void 0,onCssLoaded:void 0},c.prototype.logPrefix="chat",c.prototype._messageCount=0,c.prototype.isOpen=!1,c.prototype.blinkOnlineInterval=null,c.prototype.stopBlinOnlineStateTimeout=null,c.prototype.showTimeEveryXMinutes=2,c.prototype.lastTimestamp=null,c.prototype.lastAddedType=null,c.prototype.inputTimeout=null,c.prototype.isTyping=!1,c.prototype.state="offline",c.prototype.initialQueueDelay=1e4,c.prototype.hasSametimeStamp=null,c.prototype.translations={es:{"<strong>Chat</strong> with us!":"<strong>Chatee</strong> con nosotros!","Scroll down to see new messages":"Haga scroll hacia abajo para ver nuevos mensajes",Online:"En linea",Offline:"Desconectado",Connecting:"Conectando","Connection re-established":"Conexión restablecida",Today:"Hoy",Send:"Enviar","Chat closed by %s":"Chat cerrado por %s","Compose your message...":"Escriba su mensaje...","All colleagues are busy.":"Todos los agentes están ocupados.","You are on waiting list position <strong>%s</strong>.":"Usted está en la posición <strong>%s</strong> de la lista de espera.","Start new conversation":"Iniciar nueva conversación","Since you didn't respond in the last %s minutes your conversation with <strong>%s</strong> got closed.":"Puesto que usted no respondió en los últimos %s minutos su conversación con <strong>%s</strong> se ha cerrado.","Since you didn't respond in the last %s minutes your conversation got closed.":"Puesto que usted no respondió en los últimos %s minutos su conversación se ha cerrado.","We are sorry, it takes longer as expected to get an empty slot. Please try again later or send us an email. Thank you!":"Lo sentimos, se tarda más tiempo de lo esperado para ser atendido por un agente. Inténtelo de nuevo más tarde o envíenos un correo electrónico. ¡Gracias!"},fr:{"<strong>Chat</strong> with us!":"<strong>Chattez</strong> avec nous!","Scroll down to see new messages":"Faites défiler pour lire les nouveaux messages",Online:"En-ligne",Offline:"Hors-ligne",Connecting:"Connexion en cours","Connection re-established":"Connexion rétablie",Today:"Aujourdhui",Send:"Envoyer","Chat closed by %s":"Chat fermé par %s","Compose your message...":"Composez votre message...","All colleagues are busy.":"Tous les collègues sont actuellement occupés.","You are on waiting list position <strong>%s</strong>.":"Vous êtes actuellement en <strong>%s</strong> position dans la file d'attente.","Start new conversation":"Démarrer une nouvelle conversation","Since you didn't respond in the last %s minutes your conversation with <strong>%s</strong> got closed.":"Si vous ne répondez pas dans les <strong>%s</strong> minutes, votre conversation avec %s va être fermée.","Since you didn't respond in the last %s minutes your conversation got closed.":"Si vous ne répondez pas dans les %s minutes, votre conversation va être fermée.","We are sorry, it takes longer as expected to get an empty slot. Please try again later or send us an email. Thank you!":"Nous sommes désolés, il faut plus de temps que prévu pour obtenir un emplacement vide. Veuillez réessayer ultérieurement ou nous envoyer un courriel. Je vous remercie!"},it:{"<strong>Chat</strong> with us!":"<strong>Chatta</strong> con noi!","Scroll down to see new messages":"Scorri verso il basso per vedere i nuovi messaggi",Online:"Online",Offline:"Offline",Connecting:"Collegamento in corso","Connection re-established":"Collegamento ristabilito",Today:"Oggi",Send:"Invio","Chat closed by %s":"Chat chiusa da %s","Compose your message...":"Componi il tuo messaggio...","All colleagues are busy.":"Tutti gli operatori sono occupati.","You are on waiting list position <strong>%s</strong>.":"Sei in posizione <strong>%s</strong> nella lista d'attesa.","Start new conversation":"Avvia una nuova chat","Since you didn't respond in the last %s minutes your conversation with <strong>%s</strong> got closed.":"Dal momento che non hai risposto negli ultimi %s minuti la tua chat con <strong>%s</strong> è stata chiusa.","Since you didn't respond in the last %s minutes your conversation got closed.":"Dal momento che non hai risposto negli ultimi %s minuti la tua chat è stata chiusa.","We are sorry, it takes longer as expected to get an empty slot. Please try again later or send us an email. Thank you!":"Ci dispiace, ci vuole più tempo del previsto per arrivare al tuo turno. Per favore riprova più tardi o inviaci un'email. Grazie!"}},c.prototype.sessionId=void 0,c.prototype.scrolledToBottom=!0,c.prototype.scrollSnapTolerance=10,c.prototype.richTextFormatKey={66:!0,73:!0,85:!0,83:!0},c.prototype.T=function(){var t,e,s,i,n=arguments[0],o=2<=arguments.length?slice.call(arguments,1):[];if(this.options.lang&&"en"!==this.options.lang&&(this.translations[this.options.lang]?((i=this.translations[this.options.lang])[n]||this.log.notice("Translation needed for '"+n+"'"),n=i[n]||n):this.log.notice("Translation '"+this.options.lang+"' needed!")),o)for(e=0,s=o.length;e<s;e++)t=o[e],n=n.replace(/%s/,t);return n},c.prototype.view=function(e){return s=this,function(t){return(t=t||{}).T=s.T,t.background=s.options.background,t.flat=s.options.flat,t.fontSize=s.options.fontSize,m.zammadChatTemplates[e](t)};var s},c.prototype.getScrollRoot=function(){var t,e,s;return"scrollingElement"in document?document.scrollingElement:(s=(e=document.documentElement).scrollTop,e.scrollTop=s+1,t=e.scrollTop,(e.scrollTop=s)<t?e:document.body)},c.prototype.render=function(){return this.el&&p(".zammad-chat").get(0)||this.renderBase(),p("."+this.options.buttonClass).addClass(this.inactiveClass),this.setAgentOnlineState("online"),this.log.debug("widget rendered"),this.startTimeoutObservers(),this.idleTimeout.start(),this.sessionId=sessionStorage.getItem("sessionId"),this.send("chat_status_customer",{session_id:this.sessionId,url:m.location.href})},c.prototype.renderBase=function(){var s,l,h,t,e;if(this.el=p(this.view("chat")({title:this.options.title,scrollHint:this.options.scrollHint})),this.options.target.append(this.el),this.input=this.el.find(".zammad-chat-input"),this.el.find(".js-chat-open").click(this.open),this.el.find(".js-chat-toggle").click(this.toggle),this.el.find(".js-chat-status").click(this.stopPropagation),this.el.find(".zammad-chat-controls").on("submit",this.onSubmit),this.el.find(".zammad-chat-body").on("scroll",this.detectScrolledtoBottom),this.el.find(".zammad-scroll-hint").click(this.onScrollHintClick),this.input.on({keydown:this.checkForEnter,input:this.onInput}),this.input.on("keydown",(s=this,function(t){var e=!1;if((e=!t.altKey&&!t.ctrlKey&&t.metaKey||!t.altKey&&t.ctrlKey&&!t.metaKey?!0:e)&&s.richTextFormatKey[t.keyCode])return t.preventDefault(),66===t.keyCode?(document.execCommand("bold"),!0):73===t.keyCode?(document.execCommand("italic"),!0):85===t.keyCode?(document.execCommand("underline"),!0):83===t.keyCode?(document.execCommand("strikeThrough"),!0):void 0})),this.input.on("paste",(l=this,function(e){var s,i,t,n,o,a,r;if(e.stopPropagation(),e.preventDefault(),e.clipboardData)s=e.clipboardData;else if(m.clipboardData)s=m.clipboardData;else{if(!e.originalEvent.clipboardData)throw"No clipboardData support";s=e.originalEvent.clipboardData}if(n=!1,s&&s.items&&s.items[0]&&("file"!==(o=s.items[0]).kind||"image/png"!==o.type&&"image/jpeg"!==o.type||(t=o.getAsFile(),(o=new FileReader).onload=function(t){var e=t.target.result,n=document.createElement("img");return n.src=e,t=function(t,e,s,i){return l.isRetina()&&(e/=2,0),n='<img style="width: 100%; max-width: '+e+'px;" src="'+t+'">',document.execCommand("insertHTML",!1,n)},l.resizeImage(n.src,460,"auto",2,"image/jpeg","auto",t)},o.readAsDataURL(t),n=!0)),!n){i=r=void 0;try{r=s.getData("text/html"),i="html",r&&0!==r.length||(i="text",r=s.getData("text/plain")),r&&0!==r.length||(i="text2",r=s.getData("text"))}catch(t){e=t,console.log("Sorry, can't insert markup because browser is not supporting it."),i="text3",r=s.getData("text")}return"text"!==i&&"text2"!==i&&"text3"!==i||(r=(r="<div>"+r.replace(/\n/g,"</div><div>")+"</div>").replace(/<div><\/div>/g,"<div><br></div>")),console.log("p",i,r),"html"===i&&(t=p("<div>"+r+"</div>"),n=!1,e=r,a=new RegExp("<(/w|w):[A-Za-z]"),e.match(a)&&(n=!0,e=e.replace(a,"")),a=new RegExp("<(/o|o):[A-Za-z]"),e.match(a)&&(n=!0,e=e.replace(a,"")),n&&(t=l.wordFilter(t)),(t=p(t)).contents().each(function(){if(8===this.nodeType)return p(this).remove()}),t.find("a, font, small, time, form, label").replaceWith(function(){return p(this).contents()}),t.find("textarea").each(function(){var t=this.outerHTML;return a=new RegExp("<"+this.tagName,"i"),t=t.replace(a,"<div"),a=new RegExp("</"+this.tagName,"i"),t=t.replace(a,"</div"),p(this).replaceWith(t)}),t.find("font, img, svg, input, select, button, style, applet, embed, noframes, canvas, script, frame, iframe, meta, link, title, head, fieldset").remove(),l.removeAttributes(t),r=t.html()),"text3"===i?l.pasteHtmlAtCaret(r):document.execCommand("insertHTML",!1,r),!0}})),this.input.on("drop",(h=this,function(t){var e,a,r;if(t.stopPropagation(),t.preventDefault(),m.dataTransfer)e=m.dataTransfer;else{if(!t.originalEvent.dataTransfer)throw"No clipboardData support";e=t.originalEvent.dataTransfer}if(a=t.clientX,r=t.clientY,(t=e.files[0]).type.match("image.*"))return(e=new FileReader).onload=function(t){var e=t.target.result,o=document.createElement("img");return o.src=e,t=function(t,e,s,i){var n;return h.isRetina()&&(e/=2,0),o=(o=p('<img style="width: 100%; max-width: '+e+'px;" src="'+t+'">')).get(0),document.caretPositionFromPoint?(t=document.caretPositionFromPoint(a,r),(n=document.createRange()).setStart(t.offsetNode,t.offset),n.collapse(),n.insertNode(o)):document.caretRangeFromPoint?(n=document.caretRangeFromPoint(a,r)).insertNode(o):console.log("could not find carat")},h.resizeImage(o.src,460,"auto",2,"image/jpeg","auto",t)},e.readAsDataURL(t)})),p(m).on("beforeunload",(t=this,function(){return t.onLeaveTemporary()})),p(m).bind("hashchange",(e=this,function(){if(!e.isOpen)return e.idleTimeout.start();e.sessionId&&e.send("chat_session_notice",{session_id:e.sessionId,message:m.location.href})})),this.isFullscreen)return this.input.on({focus:this.onFocus,focusout:this.onFocusOut})},c.prototype.stopPropagation=function(t){return t.stopPropagation()},c.prototype.checkForEnter=function(t){if(!t.shiftKey&&13===t.keyCode)return t.preventDefault(),this.sendMessage()},c.prototype.send=function(t,e){return(e=null==e?{}:e).chat_id=this.options.chatId,this.io.send(t,e)},c.prototype.onWebSocketMessage=function(t){for(var e,s=0,i=t.length;s<i;s++)switch(e=t[s],this.log.debug("ws:onmessage",e),e.event){case"chat_error":this.log.notice(e.data),e.data&&"chat_disabled"===e.data.state&&this.destroy({remove:!0});break;case"chat_session_message":if(e.data.self_written)return;this.receiveMessage(e.data);break;case"chat_session_typing":if(e.data.self_written)return;this.onAgentTypingStart(e.data.whispering);break;case"chat_session_start":this.onConnectionEstablished(e.data);break;case"chat_session_queue":this.onQueueScreen(e.data);break;case"chat_session_closed":case"chat_session_left":this.onSessionClosed(e.data);break;case"chat_session_notice":this.addStatus(this.T(e.data.message));break;case"chat_status_customer":switch(e.data.state){case"online":this.sessionId=void 0,!this.options.cssAutoload||this.cssLoaded?this.onReady():this.socketReady=!0;break;case"offline":this.onError("Zammad Chat: No agent online");break;case"chat_disabled":this.onError("Zammad Chat: Chat is disabled");break;case"no_seats_available":this.onError("Zammad Chat: Too many clients in queue. Clients in queue: "+e.data.queue);break;case"reconnect":this.onReopenSession(e.data)}}},c.prototype.onReady=function(){var t;if(this.log.debug("widget ready for use"),p("."+this.options.buttonClass).click(this.open).removeClass(this.inactiveClass),"function"==typeof(t=this.options).onReady&&t.onReady(),this.options.show)return this.show()},c.prototype.onError=function(t){var e;return this.log.debug(t),this.addStatus(t),p("."+this.options.buttonClass).hide(),this.isOpen?(this.disableInput(),this.destroy({remove:!1})):this.destroy({remove:!0}),"function"==typeof(e=this.options).onError?e.onError(t):void 0},c.prototype.onReopenSession=function(t){var e,s,i,n,o;if(this.log.debug("old messages",t.session),this.inactiveTimeout.start(),o=sessionStorage.getItem("unfinished_message"),t.agent){for(this.onConnectionEstablished(t),e=0,s=(n=t.session).length;e<s;e++)i=n[e],this.renderMessage({message:i.content,id:i.id,from:i.created_by_id?"agent":"customer"});o&&this.input.html(o)}if(t.position&&this.onQueue(t),this.show(),this.open(),this.scrollToBottom(),o)return this.input.focus()},c.prototype.onInput=function(){return this.el.find(".zammad-chat-message--unread").removeClass("zammad-chat-message--unread"),sessionStorage.setItem("unfinished_message",this.input.html()),this.onTyping()},c.prototype.onFocus=function(){var t;if(p(m).scrollTop(10),t=0<p(m).scrollTop(),p(m).scrollTop(0),t)return this.log.notice("virtual keyboard shown")},c.prototype.onFocusOut=function(){},c.prototype.onTyping=function(){var t=this.input.html();this.view("message")({message:t,from:"customer",unreadClass:""});if(this.send("chat_session_message",{content:t,id:this._messageCount,session_id:this.sessionId,sneak_peek:!0}),!(this.isTyping&&this.isTyping>new Date((new Date).getTime()-1500)))return this.isTyping=new Date,this.send("chat_session_typing",{session_id:this.sessionId}),this.inactiveTimeout.start()},c.prototype.onSubmit=function(t){return t.preventDefault(),this.sendMessage()},c.prototype.sendMessage=function(){var t,e=this.input.html();if(e)return this.inactiveTimeout.start(),sessionStorage.removeItem("unfinished_message"),t=this.view("message")({message:e,from:"customer",id:this._messageCount++,unreadClass:""}),this.maybeAddTimestamp(),this.el.find(".zammad-chat-message--typing").get(0)?(this.lastAddedType="typing-placeholder",this.el.find(".zammad-chat-message--typing").before(t)):(this.lastAddedType="message--customer",this.el.find(".zammad-chat-body").append(t)),this.input.html(""),this.scrollToBottom(),this.send("chat_session_message",{content:e,id:this._messageCount,session_id:this.sessionId})},c.prototype.receiveMessage=function(t){var e,s,i,n,o,a,r,l;if(this.inactiveTimeout.start(),this.onAgentTypingEnd(),this.maybeAddTimestamp(),console.log("data.chatbot_response",t.chatbot_response),void 0!==t.chatbot_response){for(i=0,o=(r=t.chatbot_response).length;i<o;i++)if(s=r[i],this.renderMessage({message:s.text,from:"agent"}),s.hasOwnProperty("buttons")){for(n=0,a=(l=s.buttons).length;n<a;n++)e=l[n],this.renderIntentButton({btnintent:e.payload,btnlabel:e.title});this.el.find(".zammad-chat-intent").on("click",this.onClickIntentButton)}}else this.renderMessage({message:t.message.content,id:t.id,from:"agent"});return this.scrollToBottom({showHint:!0})},c.prototype.renderMessage=function(t){return this.lastAddedType="message--"+t.from,t.unreadClass=document.hidden?" zammad-chat-message--unread":"",this.el.find(".zammad-chat-body").append(this.view("message")(t))},c.prototype.renderIntentButton=function(t){return this.lastAddedType="message--agent",this.el.find(".zammad-chat-body").append(this.view("intent_button")(t))},c.prototype.onClickIntentButton=function(t){var e,s;if(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),e=t.target.getAttribute("data-intent"),s=t.target.getAttribute("data-label"),void 0!==e){if(console.log("evento",t.timeStamp),this.hasSametimeStamp!==t.timeStamp)return this.hasSametimeStamp=t.timeStamp,this.invokeIntent(e,s),console.log("non duplicato");console.log("duplicato")}},c.prototype.open=function(){var t;if(!this.isOpen)return this.isOpen=!0,this.log.debug("open widget"),this.show(),this.sessionId||this.showLoader(),this.el.addClass("zammad-chat-is-open"),t=this.el.height()-this.el.find(".zammad-chat-header").outerHeight(),this.el.css("bottom",-t),this.sessionId?(this.el.css("bottom",0),this.onOpenAnimationEnd()):(this.el.animate({bottom:0},500,this.onOpenAnimationEnd),this.send("chat_session_init",{url:m.location.href}));this.log.debug("widget already open, block")},c.prototype.onOpenAnimationEnd=function(){var t;return this.idleTimeout.stop(),this.isFullscreen&&this.disableScrollOnRoot(),"function"==typeof(t=this.options).onOpenAnimationEnd?t.onOpenAnimationEnd():void 0},c.prototype.sessionClose=function(){return this.send("chat_session_close",{session_id:this.sessionId}),this.inactiveTimeout.stop(),this.waitingListTimeout.stop(),sessionStorage.removeItem("unfinished_message"),this.onInitialQueueDelayId&&clearTimeout(this.onInitialQueueDelayId),this.setSessionId(void 0)},c.prototype.toggle=function(t){return this.isOpen?this.close(t):this.open(t)},c.prototype.close=function(t){if(this.isOpen){if(this.initDelayId&&clearTimeout(this.initDelayId),this.sessionId)return this.log.debug("close widget"),t&&t.stopPropagation(),this.sessionClose(),this.isFullscreen&&this.enableScrollOnRoot(),t=this.el.height()-this.el.find(".zammad-chat-header").outerHeight(),this.el.animate({bottom:-t},500,this.onCloseAnimationEnd);this.log.debug("can't close widget without sessionId")}else this.log.debug("can't close widget, it's not open")},c.prototype.onCloseAnimationEnd=function(){var t;return this.el.css("bottom",""),this.el.removeClass("zammad-chat-is-open"),this.showLoader(),this.el.find(".zammad-chat-welcome").removeClass("zammad-chat-is-hidden"),this.el.find(".zammad-chat-agent").addClass("zammad-chat-is-hidden"),this.el.find(".zammad-chat-agent-status").addClass("zammad-chat-is-hidden"),this.isOpen=!1,"function"==typeof(t=this.options).onCloseAnimationEnd&&t.onCloseAnimationEnd(),this.io.reconnect()},c.prototype.onWebSocketClose=function(){if(!this.isOpen)return this.el?(this.el.removeClass("zammad-chat-is-shown"),this.el.removeClass("zammad-chat-is-loaded")):void 0},c.prototype.show=function(){if("offline"!==this.state)return this.el.addClass("zammad-chat-is-loaded"),this.el.addClass("zammad-chat-is-shown")},c.prototype.disableInput=function(){return this.input.prop("disabled",!0),this.el.find(".zammad-chat-send").prop("disabled",!0)},c.prototype.enableInput=function(){return this.input.prop("disabled",!1),this.el.find(".zammad-chat-send").prop("disabled",!1)},c.prototype.hideModal=function(){return this.el.find(".zammad-chat-modal").html("")},c.prototype.onQueueScreen=function(t){var e,s;if(this.setSessionId(t.session_id),e=function(){return s.onQueue(t),s.waitingListTimeout.start()},!(s=this).initialQueueDelay||this.onInitialQueueDelayId)return this.onInitialQueueDelayId&&clearTimeout(this.onInitialQueueDelayId),e();this.onInitialQueueDelayId=setTimeout(e,this.initialQueueDelay)},c.prototype.onQueue=function(t){return this.log.notice("onQueue",t.position),this.inQueue=!0,this.el.find(".zammad-chat-modal").html(this.view("waiting")({position:t.position}))},c.prototype.onAgentTypingStart=function(t){if(this.stopTypingId&&clearTimeout(this.stopTypingId),this.stopTypingId=setTimeout(this.onAgentTypingEnd,3e3),!this.el.find(".zammad-chat-message--typing").get(0)&&(this.maybeAddTimestamp(),t||this.el.find(".zammad-chat-body").append(this.view("typingIndicator")()),this.isVisible(this.el.find(".zammad-chat-message--typing"),!0)))return this.scrollToBottom()},c.prototype.onAgentTypingEnd=function(){return this.el.find(".zammad-chat-message--typing").remove()},c.prototype.onLeaveTemporary=function(){if(this.sessionId)return this.send("chat_session_leave_temporary",{session_id:this.sessionId})},c.prototype.maybeAddTimestamp=function(){var t,e,s=Date.now();if(!this.lastTimestamp||s-this.lastTimestamp>6e4*this.showTimeEveryXMinutes)return t=this.T("Today"),e=(new Date).toTimeString().substr(0,5),"timestamp"===this.lastAddedType?(this.updateLastTimestamp(t,e),this.lastTimestamp=s):(this.el.find(".zammad-chat-body").append(this.view("timestamp")({label:t,time:e})),this.lastTimestamp=s,this.lastAddedType="timestamp",this.scrollToBottom())},c.prototype.updateLastTimestamp=function(t,e){if(this.el)return this.el.find(".zammad-chat-body").find(".zammad-chat-timestamp").last().replaceWith(this.view("timestamp")({label:t,time:e}))},c.prototype.addStatus=function(t){if(this.el)return this.maybeAddTimestamp(),this.el.find(".zammad-chat-body").append(this.view("status")({status:t})),this.scrollToBottom()},c.prototype.detectScrolledtoBottom=function(){var t=this.el.find(".zammad-chat-body").scrollTop()+this.el.find(".zammad-chat-body").outerHeight();if(this.scrolledToBottom=Math.abs(t-this.el.find(".zammad-chat-body").prop("scrollHeight"))<=this.scrollSnapTolerance,this.scrolledToBottom)return this.el.find(".zammad-scroll-hint").addClass("is-hidden")},c.prototype.invokeIntent=function(t,e){e=this.view("message")({message:e,from:"customer",id:this._messageCount++,unreadClass:""});return this.maybeAddTimestamp(),this.lastAddedType="message--customer",this.el.find(".zammad-chat-body").append(e),this.scrollToBottom(),this.send("chat_session_message",{content:t,id:this._messageCount,session_id:this.sessionId})},c.prototype.showScrollHint=function(){return this.el.find(".zammad-scroll-hint").removeClass("is-hidden"),this.el.find(".zammad-chat-body").scrollTop(this.el.find(".zammad-chat-body").scrollTop()+this.el.find(".zammad-scroll-hint").outerHeight())},c.prototype.onScrollHintClick=function(){return this.el.find(".zammad-chat-body").animate({scrollTop:this.el.find(".zammad-chat-body").prop("scrollHeight")},300)},c.prototype.scrollToBottom=function(t){t=(null!=t?t:{showHint:!1}).showHint;return this.scrolledToBottom?this.el.find(".zammad-chat-body").scrollTop(p(".zammad-chat-body").prop("scrollHeight")):t?this.showScrollHint():void 0},c.prototype.destroy=function(t){return null==t&&(t={}),this.log.debug("destroy widget",t),this.setAgentOnlineState("offline"),t.remove&&this.el&&this.el.remove(),this.waitingListTimeout&&this.waitingListTimeout.stop(),this.inactiveTimeout&&this.inactiveTimeout.stop(),this.idleTimeout&&this.idleTimeout.stop(),this.io.close()},c.prototype.reconnect=function(){return this.log.notice("reconnecting"),this.disableInput(),this.lastAddedType="status",this.setAgentOnlineState("connecting"),this.addStatus(this.T("Connection lost"))},c.prototype.onConnectionReestablished=function(){var t;return this.lastAddedType="status",this.setAgentOnlineState("online"),this.addStatus(this.T("Connection re-established")),"function"==typeof(t=this.options).onConnectionReestablished?t.onConnectionReestablished():void 0},c.prototype.onSessionClosed=function(t){var e;return this.addStatus(this.T("Chat closed by %s",t.realname)),this.disableInput(),this.setAgentOnlineState("offline"),this.inactiveTimeout.stop(),"function"==typeof(e=this.options).onSessionClosed?e.onSessionClosed(t):void 0},c.prototype.setSessionId=function(t){return void 0===(this.sessionId=t)?sessionStorage.removeItem("sessionId"):sessionStorage.setItem("sessionId",t)},c.prototype.onConnectionEstablished=function(t){var e;return this.onInitialQueueDelayId&&clearTimeout(this.onInitialQueueDelayId),this.inQueue=!1,t.agent&&(this.agent=t.agent),t.session_id&&this.setSessionId(t.session_id),this.el.find(".zammad-chat-body").html(""),this.el.find(".zammad-chat-agent").html(this.view("agent")({agent:this.agent})),this.enableInput(),this.hideModal(),this.el.find(".zammad-chat-welcome").addClass("zammad-chat-is-hidden"),this.el.find(".zammad-chat-agent").removeClass("zammad-chat-is-hidden"),this.el.find(".zammad-chat-agent-status").removeClass("zammad-chat-is-hidden"),this.isFullscreen||this.input.focus(),this.setAgentOnlineState("online"),this.waitingListTimeout.stop(),this.idleTimeout.stop(),this.inactiveTimeout.start(),"function"==typeof(e=this.options).onConnectionEstablished?e.onConnectionEstablished(t):void 0},c.prototype.showCustomerTimeout=function(){var t;return this.el.find(".zammad-chat-modal").html(this.view("customer_timeout")({agent:this.agent.name,delay:this.options.inactiveTimeout})),t=function(){return location.reload()},this.el.find(".js-restart").click(t),this.sessionClose()},c.prototype.showWaitingListTimeout=function(){var t;return this.el.find(".zammad-chat-modal").html(this.view("waiting_list_timeout")({delay:this.options.watingListTimeout})),t=function(){return location.reload()},this.el.find(".js-restart").click(t),this.sessionClose()},c.prototype.showLoader=function(){return this.el.find(".zammad-chat-modal").html(this.view("loader")())},c.prototype.setAgentOnlineState=function(t){var e;if(this.state=t,this.el)return e=t.charAt(0).toUpperCase()+t.slice(1),this.el.find(".zammad-chat-agent-status").attr("data-status",t).text(this.T(e))},c.prototype.detectHost=function(){var t="https"===o?"wss://":"ws://";return this.options.host=""+t+n+"/ws"},c.prototype.loadCss=function(){var t,e;if(this.options.cssAutoload)return(e=this.options.cssUrl)||(e=this.options.host.replace(/^wss/i,"https").replace(/^ws/i,"http").replace(/\/ws/i,""),e+="/assets/chat/chat.css"),this.log.debug("load css from '"+e+"'"),t="@import url('"+e+"');",(e=document.createElement("link")).onload=this.onCssLoaded,e.rel="stylesheet",e.href="data:text/css,"+escape(t),document.getElementsByTagName("head")[0].appendChild(e)},c.prototype.onCssLoaded=function(){var t;return this.cssLoaded=!0,this.socketReady&&this.onReady(),"function"==typeof(t=this.options).onCssLoaded?t.onCssLoaded():void 0},c.prototype.startTimeoutObservers=function(){var t,e,s;return this.idleTimeout=new i({logPrefix:"idleTimeout",debug:this.options.debug,timeout:this.options.idleTimeout,timeoutIntervallCheck:this.options.idleTimeoutIntervallCheck,callback:(t=this,function(){return t.log.debug("Idle timeout reached, hide widget",new Date),t.destroy({remove:!0})})}),this.inactiveTimeout=new i({logPrefix:"inactiveTimeout",debug:this.options.debug,timeout:this.options.inactiveTimeout,timeoutIntervallCheck:this.options.inactiveTimeoutIntervallCheck,callback:(e=this,function(){return e.log.debug("Inactive timeout reached, show timeout screen.",new Date),e.showCustomerTimeout(),e.destroy({remove:!1})})}),this.waitingListTimeout=new i({logPrefix:"waitingListTimeout",debug:this.options.debug,timeout:this.options.waitingListTimeout,timeoutIntervallCheck:this.options.waitingListTimeoutIntervallCheck,callback:(s=this,function(){return s.log.debug("Waiting list timeout reached, show timeout screen.",new Date),s.showWaitingListTimeout(),s.destroy({remove:!1})})})},c.prototype.disableScrollOnRoot=function(){return this.rootScrollOffset=this.scrollRoot.scrollTop(),this.scrollRoot.css({overflow:"hidden",position:"fixed"})},c.prototype.enableScrollOnRoot=function(){return this.scrollRoot.scrollTop(this.rootScrollOffset),this.scrollRoot.css({overflow:"",position:""})},c.prototype.isVisible=function(t,e,s,i){var n,o,a,r,l,h,c,d,u;if(!(t.length<1))return n=p(m),a=(o=1<t.length?t.eq(0):t).get(0),u=n.width(),t=n.height(),i=i||"both",s=!0!==s||a.offsetWidth*a.offsetHeight,"function"==typeof a.getBoundingClientRect?(r=0<=(c=a.getBoundingClientRect()).top&&c.top<t,d=0<c.bottom&&c.bottom<=t,l=0<=c.left&&c.left<u,h=0<c.right&&c.right<=u,c=e?r||d:r&&d,r=e?l||h:l&&h,"both"===i?s&&c&&r:"vertical"===i?s&&c:"horizontal"===i?s&&r:void 0):(l=(d=n.scrollTop())+t,c=(h=n.scrollLeft())+u,n=(t=(r=o.offset()).top)+o.height(),r=(u=r.left)+o.width(),o=!0===e?n:t,t=!0===e?t:n,n=!0===e?r:u,r=!0===e?u:r,"both"===i?!!s&&t<=l&&d<=o&&r<=c&&h<=n:"vertical"===i?!!s&&t<=l&&d<=o:"horizontal"===i?!!s&&r<=c&&h<=n:void 0)},c.prototype.isRetina=function(){var t;return!!m.matchMedia&&((t=m.matchMedia("only screen and (min--moz-device-pixel-ratio: 1.3), only screen and (-o-min-device-pixel-ratio: 2.6/2), only screen and (-webkit-min-device-pixel-ratio: 1.3), only screen  and (min-device-pixel-ratio: 1.3), only screen and (min-resolution: 1.3dppx)"))&&t.matches||1<m.devicePixelRatio)},c.prototype.resizeImage=function(t,i,n,o,a,r,l,e){var h;return null==i&&(i="auto"),null==n&&(n="auto"),null==o&&(o=1),null==e&&(e=!0),(h=new Image).onload=function(){var t,e=h.width,s=h.height;return console.log("ImageService","current size",e,s),"auto"===n&&"auto"===i&&(i=e,n=s),"auto"===n&&(n=s/(e/i)),t=!1,(i="auto"===i?s/(e/n):i)<e||n<s?(t=!0,i*=o,n*=o):(i=e,n=s),(s=document.createElement("canvas")).width=i,s.height=n,s.getContext("2d").drawImage(h,0,0,i,n),"auto"===r&&(r=i<200&&n<200?1:i<400&&n<400?.9:i<600&&n<600?.8:i<900&&n<900?.7:.6),s=s.toDataURL(a,r),t?(console.log("ImageService","resize",i/o,n/o,r,.75*s.length/1024/1024,"in mb"),void l(s,i/o,n/o,!0)):(console.log("ImageService","no resize",i,n,r,.75*s.length/1024/1024,"in mb"),l(s,i,n,!1))},h.src=t},c.prototype.pasteHtmlAtCaret=function(t){var e,s,i,n,o=void 0,a=void 0;if(m.getSelection){if((o=m.getSelection()).getRangeAt&&o.rangeCount){for((a=o.getRangeAt(0)).deleteContents(),(e=document.createElement("div")).innerHTML=t,s=document.createDocumentFragment(n,i);n=e.firstChild;)i=s.appendChild(n);if(a.insertNode(s),i)return(a=a.cloneRange()).setStartAfter(i),a.collapse(!0),o.removeAllRanges(),o.addRange(a)}}else if(document.selection&&"Control"!==document.selection.type)return document.selection.createRange().pasteHTML(t)},c.prototype.wordFilter=function(t){var a,r,e=t.html();return e=(e=(e=(e=e.replace(/<!--[\s\S]+?-->/gi,"")).replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|img|meta|link|style|\w:\w+)(?=[\s\/>]))[^>]*>/gi,"")).replace(/<(\/?)s>/gi,"<$1strike>")).replace(/&nbsp;/gi," "),t.html(e),p("p",t).each(function(){var t=p(this).attr("style"),t=/mso-list:\w+ \w+([0-9]+)/.exec(t);if(t)return p(this).data("_listLevel",parseInt(t[1],10))}),a=0,r=null,p("p",t).each(function(){var t,e,s,i,n,o=p(this).data("_listLevel");if(void 0===o)return a=0;if(n=p(this).text(),e="<ul></ul>",/^\s*\w+\./.test(n)&&(e=(s=/([0-9])\./.exec(n))?null!=(s=1<(n=parseInt(s[1],10)))?s:'<ol start="'+n+{'"></ol>':"<ol></ol>"}:"<ol></ol>"),a<o&&(r=0===a?(p(this).before(e),p(this).prev()):p(e).appendTo(r)),o<a)for(t=void 0,i=a-o;void 0<=i?t<=i:i<=t;void 0<=i?++t:--t)r=r.parent();return p("span:first",this).remove(),r.append("<li>"+p(this).html()+"</li>"),p(this).remove(),a=o}),p("[style]",t).removeAttr("style"),p("[align]",t).removeAttr("align"),p("span",t).replaceWith(function(){return p(this).contents()}),p("span:empty",t).remove(),p("[class^='Mso']",t).removeAttr("class"),p("p:empty",t).remove(),t},c.prototype.removeAttribute=function(t){var e,s,i,n,o;if(t){for(e=p(t),i=0,n=(o=t.attributes).length;i<n;i++)(s=o[i])&&s.name&&t.removeAttribute(s.name);return e.removeAttr("style").removeAttr("class").removeAttr("lang").removeAttr("type").removeAttr("align").removeAttr("id").removeAttr("wrap").removeAttr("title")}},c.prototype.removeAttributes=function(t,e){var s,i;return(e=null==e?!0:e)&&t.each((s=this,function(t,e){return s.removeAttribute(e)})),t.find("*").each((i=this,function(t,e){return i.removeAttribute(e)})),t},m.ZammadChat=c}(window.jQuery,window),window.zammadChatTemplates||(window.zammadChatTemplates={}),window.zammadChatTemplates.chat=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?n(t):""}var s=[],i=(t=t||{}).safe,n=t.escape,n=(t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");t=new String(t);return t.ecoSafe=!0,t},n||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}));return function(){(function(){s.push('<div class="zammad-chat'),this.flat&&s.push(e(" zammad-chat--flat")),s.push('"'),this.fontSize&&s.push(e(" style='font-size: "+this.fontSize+"'")),s.push('>\n  <div class="zammad-chat-header js-chat-open"'),this.background&&s.push(e(" style='background: "+this.background+"'")),s.push('>\n    <div class="zammad-chat-header-controls js-chat-toggle">\n      <span class="zammad-chat-agent-status zammad-chat-is-hidden js-chat-status" data-status="online"></span>\n      <span class="zammad-chat-header-icon">\n        <svg class="zammad-chat-header-icon-open" width="13" height="7" viewBox="0 0 13 7"><path d="M10.807 7l1.4-1.428-5-4.9L6.5-.02l-.7.7-4.9 4.9 1.414 1.413L6.5 2.886 10.807 7z" fill-rule="evenodd"/></svg>\n        <svg class="zammad-chat-header-icon-close" width="13" height="13" viewBox="0 0 13 13"><path d="m2.241.12l-2.121 2.121 4.243 4.243-4.243 4.243 2.121 2.121 4.243-4.243 4.243 4.243 2.121-2.121-4.243-4.243 4.243-4.243-2.121-2.121-4.243 4.243-4.243-4.243" fill-rule="evenodd"/></svg>\n      </span>\n    </div>\n    <div class="zammad-chat-agent zammad-chat-is-hidden">\n    </div>\n    <div class="zammad-chat-welcome">\n      <svg class="zammad-chat-icon" viewBox="0 0 24 24" width="24" height="24"><path d="M2 5C2 4 3 3 4 3h16c1 0 2 1 2 2v10C22 16 21 17 20 17H4C3 17 2 16 2 15V5zM12 17l6 4v-4h-6z"/></svg>\n      <span class="zammad-chat-welcome-text">'),s.push(this.T(this.title)),s.push('</span>\n    </div>\n  </div>\n  <div class="zammad-chat-modal"></div>\n  <div class="zammad-scroll-hint is-hidden">\n    <svg class="zammad-scroll-hint-icon" width="20" height="18" viewBox="0 0 20 18"><path d="M0,2.00585866 C0,0.898053512 0.898212381,0 1.99079514,0 L18.0092049,0 C19.1086907,0 20,0.897060126 20,2.00585866 L20,11.9941413 C20,13.1019465 19.1017876,14 18.0092049,14 L1.99079514,14 C0.891309342,14 0,13.1029399 0,11.9941413 L0,2.00585866 Z M10,14 L16,18 L16,14 L10,14 Z" fill-rule="evenodd"/></svg>\n    '),s.push(this.T(this.scrollHint)),s.push('\n  </div>\n  <div class="zammad-chat-body"></div>\n  <form class="zammad-chat-controls">\n    <div class="zammad-chat-input" rows="1" placeholder="'),s.push(this.T("Compose your message...")),s.push('" contenteditable="true"></div>\n    <button type="submit" class="zammad-chat-button zammad-chat-send"'),this.background&&s.push(e(" style='background: "+this.background+"'")),s.push(">"),s.push(this.T("Send")),s.push("</button>\n  </form>\n</div>")}).call(this)}.call(t),t.safe=i,t.escape=n,s.join("")},window.zammadChatTemplates||(window.zammadChatTemplates={}),window.zammadChatTemplates.customer_timeout=function(t){var e=[],s=(t=t||{}).safe,i=t.escape,i=(t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");t=new String(t);return t.ecoSafe=!0,t},i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}));return function(){(function(){var t;e.push('<div class="zammad-chat-modal-text">\n  '),this.agent?(e.push("\n    "),e.push(this.T("Since you didn't respond in the last %s minutes your conversation with <strong>%s</strong> got closed.",this.delay,this.agent))):(e.push("\n    "),e.push(this.T("Since you didn't respond in the last %s minutes your conversation got closed.",this.delay))),e.push("\n  "),e.push('\n  <br>\n  <div class="zammad-chat-button js-restart"'),this.background&&e.push((t=" style='background: "+this.background+"'")&&t.ecoSafe?t:void 0!==t&&null!=t?i(t):""),e.push(">"),e.push(this.T("Start new conversation")),e.push("</div>\n</div>")}).call(this)}.call(t),t.safe=s,t.escape=i,e.join("")},window.zammadChatTemplates||(window.zammadChatTemplates={}),window.zammadChatTemplates.intent_button=function(t){var e=[],s=(t=t||{}).safe,i=t.escape,i=(t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");t=new String(t);return t.ecoSafe=!0,t},i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}));return function(){(function(){var t;e.push('<button type="button" class="zammad-chat-button zammad-chat-intent" data-intent="'),e.push((t=this.btnintent)&&t.ecoSafe?t:void 0!==t&&null!=t?i(t):""),e.push('" data-label="'),e.push(this.btnlabel),e.push('">'),e.push(this.btnlabel),e.push("</button>")}).call(this)}.call(t),t.safe=s,t.escape=i,e.join("")},window.zammadChatTemplates||(window.zammadChatTemplates={}),window.zammadChatTemplates.loader=function(t){var e=[],s=(t=t||{}).safe,i=t.escape,i=(t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");t=new String(t);return t.ecoSafe=!0,t},i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}));return function(){(function(){e.push('<span class="zammad-chat-loading-animation">\n  <span class="zammad-chat-loading-circle"></span>\n  <span class="zammad-chat-loading-circle"></span>\n  <span class="zammad-chat-loading-circle"></span>\n</span>\n<span class="zammad-chat-modal-text">'),e.push(this.T("Connecting")),e.push("</span>")}).call(this)}.call(t),t.safe=s,t.escape=i,e.join("")},window.zammadChatTemplates||(window.zammadChatTemplates={}),window.zammadChatTemplates.message=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?n(t):""}var s=[],i=(t=t||{}).safe,n=t.escape,n=(t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");t=new String(t);return t.ecoSafe=!0,t},n||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}));return function(){(function(){s.push('<div class="zammad-chat-message zammad-chat-message--'),s.push(e(this.from)),s.push(e(this.unreadClass)),s.push('">\n  <span class="zammad-chat-message-body"'),this.background&&"customer"===this.from&&s.push(e(" style='background: "+this.background+"'")),s.push(">"),s.push(this.message),s.push("</span>\n</div>")}).call(this)}.call(t),t.safe=i,t.escape=n,s.join("")},window.zammadChatTemplates||(window.zammadChatTemplates={}),window.zammadChatTemplates.status=function(t){var e=[],s=(t=t||{}).safe,i=t.escape,i=(t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");t=new String(t);return t.ecoSafe=!0,t},i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}));return function(){(function(){e.push('<div class="zammad-chat-status">\n  <div class="zammad-chat-status-inner">\n    '),e.push(this.status),e.push("\n  </div>\n</div>")}).call(this)}.call(t),t.safe=s,t.escape=i,e.join("")},window.zammadChatTemplates||(window.zammadChatTemplates={}),window.zammadChatTemplates.timestamp=function(t){function e(t){return t&&t.ecoSafe?t:void 0!==t&&null!=t?n(t):""}var s=[],i=(t=t||{}).safe,n=t.escape,n=(t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");t=new String(t);return t.ecoSafe=!0,t},n||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}));return function(){(function(){s.push('<div class="zammad-chat-timestamp"><strong>'),s.push(e(this.label)),s.push("</strong> "),s.push(e(this.time)),s.push("</div>")}).call(this)}.call(t),t.safe=i,t.escape=n,s.join("")},window.zammadChatTemplates||(window.zammadChatTemplates={}),window.zammadChatTemplates.typingIndicator=function(t){var e=[],s=(t=t||{}).safe,i=t.escape,i=(t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");t=new String(t);return t.ecoSafe=!0,t},i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}));return function(){(function(){e.push('<div class="zammad-chat-message zammad-chat-message--typing zammad-chat-message--agent">\n  <span class="zammad-chat-message-body">\n    <span class="zammad-chat-loading-animation">\n      <span class="zammad-chat-loading-circle"></span>\n      <span class="zammad-chat-loading-circle"></span>\n      <span class="zammad-chat-loading-circle"></span>\n    </span>\n  </span>\n</div>')}).call(this)}.call(t),t.safe=s,t.escape=i,e.join("")},window.zammadChatTemplates||(window.zammadChatTemplates={}),window.zammadChatTemplates.waiting=function(t){var e=[],s=(t=t||{}).safe,i=t.escape,i=(t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");t=new String(t);return t.ecoSafe=!0,t},i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}));return function(){(function(){e.push('<div class="zammad-chat-modal-text">\n  <span class="zammad-chat-loading-animation">\n    <span class="zammad-chat-loading-circle"></span>\n    <span class="zammad-chat-loading-circle"></span>\n    <span class="zammad-chat-loading-circle"></span>\n  </span>\n  '),e.push(this.T("All colleagues are busy.")),e.push("<br>\n  "),e.push(this.T("You are on waiting list position <strong>%s</strong>.",this.position)),e.push("\n</div>")}).call(this)}.call(t),t.safe=s,t.escape=i,e.join("")},window.zammadChatTemplates||(window.zammadChatTemplates={}),window.zammadChatTemplates.waiting_list_timeout=function(t){var e=[],s=(t=t||{}).safe,i=t.escape,i=(t.safe=function(t){if(t&&t.ecoSafe)return t;void 0!==t&&null!=t||(t="");t=new String(t);return t.ecoSafe=!0,t},i||(t.escape=function(t){return(""+t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}));return function(){(function(){var t;e.push('<div class="zammad-chat-modal-text">\n  '),e.push(this.T("We are sorry, it takes longer as expected to get an empty slot. Please try again later or send us an email. Thank you!")),e.push('\n  <br>\n  <div class="zammad-chat-button js-restart"'),this.background&&e.push((t=" style='background: "+this.background+"'")&&t.ecoSafe?t:void 0!==t&&null!=t?i(t):""),e.push(">"),e.push(this.T("Start new conversation")),e.push("</div>\n</div>")}).call(this)}.call(t),t.safe=s,t.escape=i,e.join("")};